---
sidebar: sidebar 
permalink: task_backup_to_s3.html 
keywords: backing up, restoring, back up, backup, restore, cloud volumes ontap, aws, back up volumes, backup to s3, restore volumes, vpc endpoint, billing, cost 
summary: S3 へのバックアップは、クラウドデータを完全に管理して保護するバックアップとリストアの機能を提供する、 Cloud Volumes ONTAP のアドオン機能です。バックアップは、ほぼ長期のリカバリやクローニングに使用されるボリュームの Snapshot コピーとは無関係に S3 オブジェクトストレージに格納されます。 
---
= Amazon S3 へのデータのバックアップ
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
S3 へのバックアップは、クラウドデータを完全に管理して保護するバックアップとリストアの機能を提供する、 Cloud Volumes ONTAP のアドオン機能です。バックアップは、ほぼ長期のリカバリやクローニングに使用されるボリュームの Snapshot コピーとは無関係に S3 オブジェクトストレージに格納されます。

S3 へのバックアップを有効にすると、サービスはデータのフルバックアップを実行します。追加のバックアップはすべて増分バックアップです。つまり、変更されたブロックと新しいブロックのみがバックアップされます。

https://cloud.netapp.com/cloud-backup-service["価格の詳細については、 NetApp Cloud Central をご覧ください"^]。

すべてのバックアップ処理とリストア処理には Cloud Manager を使用する必要があります。ONTAP または Amazon S3 から直接操作を実行した場合、サポートされない構成になります。



== クイックスタート

これらの手順を実行してすぐに作業を開始するか、残りのセクションまでスクロールして詳細を確認してください。



==== image:number1.png["番号 1"] 構成がサポートされていることを確認します

[role="quick-margin-para"]
次の点を確認します。

[role="quick-margin-list"]
* Cloud Volumes ONTAP 9.4 以降はサポート対象の AWS リージョンで実行されています： Nバージニア、オレゴン、アイルランド、フランクフルト、シドニー
* 新しいにサブスクライブしました https://aws.amazon.com/marketplace/pp/B07QX2QLXX["Cloud Manager Marketplace のサービス"^]
* TCP ポート 5010 は、 Cloud Volumes ONTAP のセキュリティグループのアウトバウンドトラフィックに対してオープン（デフォルトでオープン）
* TCP ポート 8088 は、 Cloud Manager のセキュリティグループ（デフォルトで開いている）のアウトバウンドトラフィック用に開かれています。
* 次のエンドポイントに Cloud Manager からアクセスできます。
+
\ https://w86yt021u5.execute-api.us-east-1.amazonaws.com/production/whitelist

* Cloud Manager では、 VPC に最大 2 つのインターフェイス VPC エンドポイントを割り当てることができます（ VPC あたりの AWS の上限は 20 ）。
* Cloud Manager に、最新のでリストされている VPC エンドポイントの権限を使用する権限があります https://mysupport.netapp.com/cloudontap/iampolicies["Cloud Manager ポリシー"^]：
+
[source, json]
----
"ec2:DescribeVpcEndpoints",
"ec2:CreateVpcEndpoint",
"ec2:ModifyVpcEndpoint",
"ec2:DeleteVpcEndpoints"
----




==== image:number2.png["番号2."] 新規または既存のシステムで S3 へのバックアップを有効にします

[role="quick-margin-list"]
* 新しいシステム： S3 へのバックアップ機能は、作業環境ウィザードではデフォルトで有効になっています。このオプションは必ず有効にしておいてください。
* 既存システム：作業環境を開き、バックアップ設定アイコンをクリックしてバックアップを有効にします。
+
image:screenshot_backup_to_s3_icon.gif["作業環境を開いたあとに使用できる S3 へのバックアップアイコンのスクリーンショット。"]





==== image:number3.png["番号3."] 必要に応じて、バックアップポリシーを変更します

[role="quick-margin-para"]
デフォルトポリシーでは、毎日ボリュームがバックアップされ、各ボリュームのバックアップコピーが 30 個保持されます。必要に応じて、保持するバックアップコピーの数を変更できます。

[role="quick-margin-para"]
image:screenshot_backup_to_s3_settings.gif["S3 へのバックアップ設定を示すスクリーンショット。機能を有効または無効にして、バックアップの保持を選択できます。"]



==== image:number4.png["番号4."] 必要に応じて、データをリストアします

[role="quick-margin-para"]
Cloud Manager の上部で、 * Backup & Restore * をクリックし、ボリュームを選択してバックアップを選択し、バックアップから新しいボリュームにデータをリストアします。

[role="quick-margin-para"]
image:screenshot_backup_to_s3_restore_icon.gif["ボリュームを選択したあとのバックアップのリストアアイコンのスクリーンショット。"]



== 要件

S3 へのボリュームのバックアップを開始する前に、次の要件を読み、サポートされている構成になっていることを確認してください。

サポートされている ONTAP のバージョン:: S3 へのバックアップは、 Cloud Volume ONTAP 9.4 以降でサポートされます。
サポートされている AWS リージョン:: 次の AWS リージョンでは、 Cloud Volumes ONTAP で S3 へのバックアップがサポートされます。
+
--
* 米国東部（ N（バージニア州）
* US West （オレゴン州）
* EU （アイルランド）
* 欧州（フランクフルト）
* アジア太平洋地域（シドニー）


--
AWS 権限が必要です:: Cloud Manager に権限を提供する IAM ロールには次の権限が必要です。
+
--
[source, json]
----
"ec2:DescribeVpcEndpoints",
"ec2:CreateVpcEndpoint",
"ec2:ModifyVpcEndpoint",
"ec2:DeleteVpcEndpoints"
----
--
AWS サブスクリプションの要件:: 3.7.3 リリースから、 AWS Marketplace で新しい Cloud Manager サブスクリプションが提供されるようになりました。このサブスクリプションでは、 Cloud Volumes ONTAP 9.6 以降の PAYGO システムと Backup to S3 機能の導入が可能です。必要です https://aws.amazon.com/marketplace/pp/B07QX2QLXX["この新しい Cloud Manager サブスクリプションに登録してください"^] S3 へのバックアップを有効にする前に、S3 へのバックアップ機能に対する請求は、このサブスクリプションを通じて行われます。
ポート要件::
+
--
* TCP ポート 5010 は、 Cloud Volumes ONTAP からバックアップサービスへの発信トラフィックに対してオープンである必要があります。
* Cloud Manager のセキュリティグループ上のアウトバウンドトラフィックには、 TCP ポート 8088 が開いている必要があります。
+
これらのポートは、事前定義されたセキュリティグループを使用した場合はすでに開いています。ただし、独自のポートを使用している場合は、これらのポートを開く必要があります。



--
アウトバウンドインターネットアクセス:: 次のエンドポイントに Cloud Manager からアクセスできることを確認してください： https://w86yt021u5.execute-api.us-east-1.amazonaws.com/production/whitelist
+
--
Cloud Manager がこのエンドポイントにアクセスし、 S3 へのバックアップで許可するユーザのリストに AWS アカウント ID を追加します。

--
インターフェイス VPC エンドポイント:: Backup to S3 機能を有効にすると、 Cloud Volumes ONTAP が実行されている VPC にインターフェイス VPC エンドポイントが Cloud Manager によって作成されます。この _ バックアップエンドポイント _ は、 S3 へのバックアップが実行されている NetApp VPC に接続します。ボリュームをリストアすると、 Cloud Manager によって追加のインターフェイス VPC エンドポイント - - The _ restore endpoint_ が作成されます。
+
--
VPC 内の他の Cloud Volumes ONTAP システムでは、これらの 2 つの VPC エンドポイントを使用します。

https://docs.aws.amazon.com/vpc/latest/userguide/amazon-vpc-limits.html#vpc-limits-endpoints["インターフェイス VPC エンドポイントのデフォルトの制限は、 VPC ごとに 20 です"^]。この機能を有効にする前に、 VPC が制限に達していないことを確認してください。

--




== 新しいシステムでの S3 へのバックアップの有効化

S3 へのバックアップ機能は、作業環境ウィザードではデフォルトで有効になっています。このオプションは必ず有効にしておいてください。

.手順
. [ Cloud Volumes ONTAP の作成 *] をクリックします。
. クラウドプロバイダとして Amazon Web Services を選択し、シングルノードまたは HA システムを選択します。
. [ 詳細と資格情報 ] ページに入力します。
. S3 へのバックアップページで、機能を有効なままにして続行をクリックします。
+
image:screenshot_backup_to_s3.gif["は、作業環境ウィザードの S3 へのバックアップオプションを示しています。"]

. ウィザードの各ページを設定し、システムを導入します。


.結果
S3 へのバックアップ機能はシステムで有効になっており、ボリュームを毎日バックアップし、 30 個のバックアップコピーを保持します。 <<バックアップ保持期間を変更しています,バックアップ保持の変更方法について説明します>>。



== 既存のシステムでの S3 へのバックアップの有効化

サポートされている構成を実行していれば、既存の Cloud Volumes ONTAP システムで S3 へのバックアップを有効にすることができます。詳細については、を参照してください <<要件>>。

.手順
. 作業環境を開きます。
. バックアップ設定アイコンをクリックします。
+
image:screenshot_backup_to_s3_icon.gif["作業環境を開いたあとに使用できる S3 へのバックアップ設定アイコンを示すスクリーンショット。"]

. [ すべてのボリュームを自動的にバックアップする *] を選択します。
. バックアップの保持を選択し、 * Save * をクリックします。
+
image:screenshot_backup_to_s3_settings.gif["S3 へのバックアップ設定を示すスクリーンショット。機能を有効または無効にして、バックアップの保持を選択できます。"]



.結果
S3 へのバックアップ機能は、各ボリュームの初期バックアップの作成時に開始されます。



== バックアップ保持期間を変更しています

デフォルトポリシーでは、毎日ボリュームがバックアップされ、各ボリュームのバックアップコピーが 30 個保持されます。保持するバックアップコピーの数は変更できます。

.手順
. 作業環境を開きます。
. バックアップ設定アイコンをクリックします。
+
image:screenshot_backup_to_s3_icon.gif["作業環境を開いたあとに使用できる S3 へのバックアップアイコンのスクリーンショット。"]

. バックアップの保持期間を変更し、 * Save * をクリックします。
+
image:screenshot_backup_to_s3_settings.gif["S3 へのバックアップ設定を示すスクリーンショット。機能を有効または無効にして、バックアップ保持を選択できます。"]





== ボリュームをリストアする

バックアップからデータをリストアすると、 Cloud Manager は _new_volume へのフルボリュームリストアを実行します。データは同じ作業環境または別の作業環境にリストアできます。

.手順
. Cloud Manager の上部で、 * Backup & Restore * をクリックします。
. リストアするボリュームを選択します。
+
image:screenshot_backup_to_s3_volume.gif["バックアップと復元タブのスクリーンショット。バックアップがあるボリュームを示しています。"]

. リストアするバックアップを見つけ、リストアアイコンをクリックします。
+
image:screenshot_backup_to_s3_restore_icon.gif["ボリュームを選択したあとのバックアップのリストアアイコンのスクリーンショット。"]

. ボリュームのリストア先となる作業環境を選択します。
. ボリュームの名前を入力します。
. [* リストア ] をクリックします。
+
image:screenshot_backup_to_s3_restore_options.gif["リストアオプションを示すスクリーンショット：リストア先の作業環境、ボリュームの名前、およびボリューム情報が表示されています。"]





== バックアップを削除する

バックアップは、 Cloud Manager から削除するまで S3 に保持されます。ボリュームを削除しても、 Cloud Volumes ONTAP システムを削除しても、バックアップは削除されません。

.手順
. Cloud Manager の上部で、 * Backup & Restore * をクリックします。
. ボリュームを選択します。
. 削除するバックアップを見つけ、削除アイコンをクリックします。
+
image:screenshot_backup_to_s3_delete_icon.gif["ボリュームを選択したあとのバックアップの削除アイコンのスクリーンショット。"]

. バックアップの削除を確定します。




== S3 へのバックアップの無効化

S3 へのバックアップを無効にすると、システムの各ボリュームのバックアップが無効になります。既存のバックアップは削除されません。

.手順
. 作業環境を開きます。
. バックアップ設定アイコンをクリックします。
+
image:screenshot_backup_to_s3_icon.gif["作業環境を開いたあとに使用できる S3 へのバックアップアイコンのスクリーンショット。"]

. すべてのボリュームを自動的にバックアップする * を無効にし、 * 保存 * をクリックします。




== S3 へのバックアップの仕組み

次のセクションでは、 S3 へのバックアップ機能について詳しく説明します。



=== バックアップの保管場所バックアップノバショ

バックアップコピーは、 Cloud Volumes ONTAP システムが配置されているリージョンのネットアップ所有の S3 バケットに格納されます。



=== 増分バックアップです

データの初回のフルバックアップ以降は、追加のバックアップはすべて増分されるため、変更されたブロックと新しいブロックのみがバックアップされます。



=== バックアップは午前 0 時に作成されます

日次バックアップは、毎日午前 0 時を過ぎた直後に開始されます。現時点では、ユーザが指定した時間にバックアップ処理をスケジュールすることはできません。



=== バックアップコピーは Cloud Central アカウントに関連付けられます

バックアップコピーはに関連付けられます link:concept_cloud_central_accounts.html["Cloud Central アカウント"] Cloud Manager が配置されます。

同じ Cloud Central アカウントに複数の Cloud Manager システムがある場合、各 Cloud Manager システムには同じバックアップのリストが表示されます。これには、他の Cloud Manager システムの Cloud Volumes ONTAP インスタンスに関連付けられたバックアップが含まれます。



=== バックアップポリシーはシステム全体に適用されます

保持するバックアップの数はシステムレベルで定義されます。システム上のボリュームごとに異なるポリシーを設定することはできません。



=== セキュリティ

バックアップデータは、転送中の AES-256 ビット暗号化と TLS 1.2 HTTPS 接続によって保護されます。

データは、セキュアな Direct Connect リンクを経由してサービスに送信され、 AES 256 ビット暗号化によって保管データが保護されます。その後、暗号化されたデータが HTTPS TLS 1.2 接続を使用してクラウドに書き込まれます。データは、セキュアな VPC エンドポイント接続を介してのみ Amazon S3 に転送されるため、インターネット経由ではトラフィックが送信されません。

各ユーザには、サービスが所有する全体的な暗号化キーに加えて、テナントキーが割り当てられます。この要件は、銀行で顧客の安全を確保するために、 1 組のキーを必要とする場合と同様です。クラウドクレデンシャルとしてのすべてのキーは、サービスによって安全に保管され、サービスの保守を担当する特定のネットアップ担当者にのみ制限されます。



=== 制限

* 次のいずれかのタイプのインスタンスを使用する場合、 Cloud Volumes ONTAP システムは最大 20 個のボリュームを S3 にバックアップできます。
+
** m4.xlarge
** m5.xlarge のように指定します
** R4.xlarge （ R4.xlarge ）
** R5.xlarge （ R5.xlarge ）


* Cloud Manager 以外で作成したボリュームは、自動的に S3 にバックアップされません。
+
たとえば、 ONTAP CLI 、 ONTAP API 、または System Manager からボリュームを作成した場合、そのボリュームは自動的にはバックアップされません。

+
これらのボリュームをバックアップする場合は、 S3 へのバックアップを無効にしてから再度有効にする必要があります。

* バックアップからデータをリストアすると、 Cloud Manager は _new_volume へのフルボリュームリストアを実行します。この新しいボリュームは S3 に自動的にバックアップされません。
+
リストア処理で作成されたボリュームをバックアップする場合は、 S3 へのバックアップを無効にしてから再度有効にする必要があります。

* バックアップできるボリュームのサイズは 50TB 以下です。
* S3 へのバックアップでは、ボリュームのバックアップを合計 245 個まで保持できます。
* S3 へのバックアップが有効になっている場合は、 Cloud Volumes ONTAP システムで WORM ストレージはサポートされません。

